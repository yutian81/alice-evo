name: ğŸš€ Alice Evo è‡ªåŠ¨éƒ¨ç½² py ç‰ˆ

on:
  # schedule:
  #   - cron: '0 0 * * *'
  repository_dispatch:
    types: [service-down-alert]
  workflow_dispatch:

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - name: æ£€æŸ¥è§¦å‘äº‹ä»¶
        run: |
          echo "Workflow triggered by: ${{ github.event_name }}"
          if [[ "${{ github.event_name }}" == "repository_dispatch" ]]; then
            echo "è§¦å‘äº‹ä»¶ç±»å‹ (Event Type): ${{ github.event.action }}"
            echo "æ”¶åˆ°æ¥è‡ª Uptime Kuma çš„ä¸‹çº¿é€šçŸ¥ï¼Œå¼€å§‹æ‰§è¡Œè‡ªåŠ¨å”¤é†’æµç¨‹..."
          elif [[ "${{ github.event_name }}" == "workflow_dispatch" ]]; then
            echo "å·¥ä½œæµè¢«æ‰‹åŠ¨è§¦å‘ï¼Œå¼€å§‹æ‰§è¡Œå”¤é†’..."
          else
            echo "å·¥ä½œæµç”±è®¡åˆ’ä»»åŠ¡è§¦å‘ï¼Œå¼€å§‹æ‰§è¡Œå”¤é†’..."
          fi
    
      - name: â¬‡ï¸ æ£€å‡ºä»£ç 
        uses: actions/checkout@v4

      - name: ğŸ› ï¸ å®‰è£… Python
        uses: actions/setup-python@v4
        with:
          python-version: "3.x"  

      - name: ğŸ› ï¸ å®‰è£…ä¾èµ–
        run: |
          pip install requests

      - name: ğŸ”‘ æ³¨å…¥ SSH ç§é’¥åˆ° Agent
        uses: webfactory/ssh-agent@v0.9.0
        with:
          ssh-private-key: ${{ secrets.ALICE_SSH_KEY }}

      - name: ğŸš€ æ‰§è¡Œ Alice Evo è‡ªåŠ¨åŒ–éƒ¨ç½²è„šæœ¬
        env:
          ALICE_CLIENT_ID: ${{ secrets.ALICE_CLIENT_ID }}
          ALICE_API_SECRET: ${{ secrets.ALICE_API_SECRET }}
          ALICE_ACCOUNT_USER: ${{ secrets.ALICE_ACCOUNT_USER }}
          PRODUCT_ID: "38"
          OS_ID: "1"
          DEPLOY_TIME_HOURS: "24"
          ALICE_SSH_KEY_NAME: "alice-yutian81"
          NODEJS_COMMAND: "${{ secrets.NODEJS_COMMAND }}"
          TG_BOT_TOKEN: ${{ secrets.TG_BOT_TOKEN }}
          TG_CHAT_ID: ${{ secrets.TG_CHAT_ID }}
        run: |
          python3 alice.py
          
