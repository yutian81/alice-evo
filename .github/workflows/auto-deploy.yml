name: ğŸš€ Alice Evo VM è‡ªåŠ¨éƒ¨ç½²

on:
  schedule:
    - cron: '0 19 * * *' # UTCæ—¶é—´19:00 = åŒ—äº¬æ—¶é—´æ¬¡æ—¥03:00
  # repository_dispatch:
  #   types: [service-down-alert]
  workflow_dispatch:

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      #  - name: æ£€æŸ¥è§¦å‘äº‹ä»¶
      #    run: |
      #      echo "Workflow triggered by: ${{ github.event_name }}"
      #      if [[ "${{ github.event_name }}" == "repository_dispatch" ]]; then
      #        echo "è§¦å‘äº‹ä»¶ç±»å‹ (Event Type): ${{ github.event.action }}"
      #        echo "æ”¶åˆ°æ¥è‡ª Uptime Kuma çš„ä¸‹çº¿é€šçŸ¥ï¼Œå¼€å§‹æ‰§è¡Œè‡ªåŠ¨å”¤é†’æµç¨‹..."
      #      elif [[ "${{ github.event_name }}" == "workflow_dispatch" ]]; then
      #        echo "å·¥ä½œæµè¢«æ‰‹åŠ¨è§¦å‘ï¼Œå¼€å§‹æ‰§è¡Œå”¤é†’..."
      #      else
      #        echo "å·¥ä½œæµç”±è®¡åˆ’ä»»åŠ¡è§¦å‘ï¼Œå¼€å§‹æ‰§è¡Œå”¤é†’..."
      #      fi

      - name: â¬‡ï¸ æ£€å‡ºä»£ç 
        uses: actions/checkout@v4

      - name: ğŸ› ï¸ å®‰è£…ä¾èµ– (jq, ssh)
        run: |
          sudo apt-get update
          sudo apt-get install -y jq ssh

      - name: ğŸ”‘ æ³¨å…¥ SSH ç§é’¥åˆ° Agent
        uses: webfactory/ssh-agent@v0.9.0
        with:
          ssh-private-key: ${{ secrets.ALICE_SSH_KEY }}

      - name: ğŸš€ è‡ªåŠ¨éƒ¨ç½² nodejs-argo
        id: deploy
        env:
          ALICE_CLIENT_ID: ${{ secrets.ALICE_CLIENT_ID }}
          ALICE_API_SECRET: ${{ secrets.ALICE_API_SECRET }}
          NODEJS_COMMAND: ${{ vars.NODEJS_COMMAND }}
          TG_BOT_TOKEN: ${{ secrets.TG_BOT_TOKEN }}
          TG_CHAT_ID: ${{ secrets.TG_CHAT_ID }}
        run: |
          chmod +x alice-renew.sh
          ./alice-renew.sh
